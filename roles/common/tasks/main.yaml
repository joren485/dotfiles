---

- name: "Set hostname"
  become: yes
  hostname:
    name: "{{ inventory_hostname }}"

- name: "Set locale"
  become: yes
  block:
    - name: "Ensure en_US.UTF-8 exists"
      locale_gen:
        name: "en_US.UTF-8"

    - name: "Ensure nl_NL.UTF-8 exists"
      locale_gen:
        name: "nl_NL.UTF-8"

- name: "Disable system beep"
  become: yes
  lineinfile:
    path: "/etc/modprobe.d/nobeep.conf"
    owner: "root"
    group: "root"
    mode: "0644"
    line: "blacklist pcspkr"
    create: yes

- name: "Update bootloader after update"
  become: yes
  systemd:
    name: "systemd-boot-update"
    state: "started"
    enabled: "yes"

- name: "Do nothing when the lid closes"
  when: "'homelab' in group_names"
  block:
    - name: "Create /etc/systemd/logind.conf.d/"
      become: yes
      file:
        path: "/etc/systemd/logind.conf.d/"
        state: "directory"
        mode: "0755"
        owner: "root"
        group: "root"

    - name: "Copy lid.conf"
      become: yes
      copy:
        src: "lid.conf"
        dest: "/etc/systemd/logind.conf.d/lid.conf"
        mode: "0755"
        owner: "root"
        group: "root"
