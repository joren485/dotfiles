---

- name: "Install packages"
  pacman:
    name:
      - "sudo"

- name: "Allow wheel group sudo permissions"
  become: yes
  copy:
    src: "00-wheel"
    dest: "/etc/sudoers.d/00-wheel"
    mode: "0440"
    owner: "root"
    group: "root"
    validate: "visudo -cf %s"

- name: "Disable root password"
  become: yes
  user:
    name: "root"
    password_lock: yes

- name: "Disable locking user after 3 tries"
  become: yes
  lineinfile:
    dest: "/etc/security/faillock.conf"
    regexp: '#? ?deny ?= ?\d+'
    line: "deny = 0"
    state: "present"

- name: "Create main user"
  become: yes
  user:
    name: "{{ ansible_user }}"
    state: "present"
    append: yes
    groups:
      - "wheel"

- name: "Add user to adbusers group"
  when: "'android-tools' in packages_host"
  become: yes
  user:
    name: "{{ ansible_user }}"
    groups: "adbusers"
    append: yes
